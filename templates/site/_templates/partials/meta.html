{% import "macros/macros.html" as macros %}

{% set site_name = site.data.settings.site_name %}
{% set site_description = site.data.settings.site_description %}
{% set site_keywords = site.data.settings.site_keywords %}

{% set description = macros.description(description, site_description, 140, true) %}

{% if not image and site.data.settings %}
  {% set favicon = site.data.settings.favicon %}
  {% set image = favicon.url %}
{% endif %}

{% if not facebook_app_id and site.data.settings %}
  {% set facebook_app_id = site.data.settings.facebook_app_id %}
{% endif %}

{% if not address and site.data.settings %}
  {% set address = site.data.settings.address %}
{% endif %}

{% if not keywords %}
  {% set keywords = site_keywords %}
{% endif %}

{% if not canonical %}
  {% set canonical = macros.absolute_url(page.url) %}
{% endif %}

{% if image %}
  {% if not image | startsWith("http") %}
    {% set image = macros.absolute_url(image) %}
  {% endif %}
{% endif %}

{% if og_image %}
  {% if not og_image | startsWith("http") %}
    {% set og_image = macros.absolute_url(og_image) %}
  {% endif %}
{% endif %}

{% if twitter_image %}
  {% if not twitter_image | startsWith("http") %}
    {% set twitter_image = macros.absolute_url(twitter_image) %}
  {% endif %}
{% endif %}

{% if video %}
  {% if not video | startsWith("http") %}
    {% set video = macros.absolute_url(video) %}
  {% endif %}
{% endif %}

{% if og_video %}
  {% if not og_video | startsWith("http") %}
    {% set og_video = macros.absolute_url(og_video) %}
  {% endif %}
{% endif %}


{% if description %}<meta name="description" content="{{ description | trim }}">{% endif %}
{% if keywords %}<meta name="keywords" content="{{ keywords | escape('html') | trim }}">{% endif %}

<meta property="og:type" content="{{ og_type | default('website') | escape('html') | trim }}">
<meta property="og:title" content="{{ title | default(site_name) | escape('html') | trim }}">
<meta property="og:url" content="{{ canonical }}">
<meta property="og:site_name" content="{{ site_name | escape('html') | trim }}">
{% if description %}<meta property="og:description" content="{{ description | trim }}">{% endif %}
{% if image or og_image %}<meta property="og:image" content="{{ og_image | default(image) | trim }}">{% endif %}
{% if video or og_video %}<meta property="og:video" content="{{ og_video | default(video) | trim }}">{% endif %}
{% if facebook_app_id %}<meta property="fb:app_id" content="{{ facebook_app_id | trim }}">{% endif %}

<meta name="twitter:card" content="{{ twitter_card | default('summary') | escape('html') | trim }}">
<meta name="twitter:url" content="{{ canonical }}">
<meta name="twitter:title" content="{{ title | default(site_name) | escape('html') | trim }}">
{% if description %}<meta name="twitter:description" content="{{ description | trim }}">{% endif %}
{% if image or twitter_image %}<meta name="twitter:image" content="{{ twitter_image | default(image) }}">{% endif %}

{% if type == 'business.business' and address %}
<meta property="business:contact_data:street_address" content="{{ address.street1 }}" />
<meta property="business:contact_data:locality" content="{{ address.city }}" />
<meta property="business:contact_data:postal_code" content="{{ address.zip }}" />
<meta property="business:contact_data:country_name" content="{{ address.country }}" />
{% endif %}

<link rel="canonical" href="{{ canonical }}">
